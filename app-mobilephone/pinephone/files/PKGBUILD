# Maintainer : Philip MÃ¼ller <philm@manjaro.org>
# Contributor: Arnaud Ferraris <arnaud.ferraris@gmail.com>

pkgname=pinephone-manjaro-tweaks
pkgver=20$(date +%y%m%d)
pkgrel=2
pkgdesc="Manjaro ARM's PinePhone tweaks"
arch=('any')
url="https://www.manjaro.org"
license=('GPL')
provides=('libhandy1')
conflicts=('libhandy1') # so update works
source=(manjaro-tweaks.sh
        90_manjaro.gschema.override
        manjaro.cfg
        autoconfig.js
        99-automount-sd.rules
        90-usb-gadget-managed.rules
        manjaro.json
        org.freedesktop.ModemManager1.pkla
        ignore-power-key.conf
        gtk3-settings.ini
        01-phoc-scaling dconf-profile-manjaro
        10-proximity.rules
	avahi-discover.desktop
	bssh.desktop
	bvnc.desktop
	ca.desrt.dconf-editor.desktop
	lstopo.desktop
	org.gnome.Terminal.desktop
        org.gnome.Extensions.desktop
	qv4l2.desktop
	qvidcap.desktop
	vim.desktop
        telegramdesktop.desktop
        UserFeedbackConsole.desktop
        pinephone-suspend-hook.sh
        20-pinephone-led.rules
        phosh-renice.service
        phosh_renice.sh)
install=$pkgname.install
sha256sums=('ac6e736e690f3a3622266a4f7715ba2178914729305e177515af6012a4b637eb'
            '75c9ab78dcc69faae3ef74d86a60dd0be836b1a412dfcc5493e290918ca0b4b0'
            'c824027f23752b05aceb2c03298f771b290a580cb3d2f681c0966ed0710e2491'
            '515b9adefb1d61ec7d4906bbd47cb6f6531380a173806714f720cdc861aa693b'
            '202f1db396341403231b5f37ff673ec3352dcd7cc14a5c2885239c297812a631'
            'bd2d2110b414b9a49479e9fce3ba7c52c368f265f760bfa20c882e0903c2f4fd'
            'b9803e7b5161ad8471fa872ee225bbadb04e007b4b1fa2ecbaeb509550624742'
            '07bd04d09995b707c9b25ad695950401651328b00c2c03f69f70907b01a94d13'
            '89049b70e47de31aa196f7246d0b1dfdbbe36dbbcc75a937383c22d8586bbffa'
            'ce67c56911f9a6dcda96379e3b79202ca7311e6166a6871ec961382bf46cf205'
            'bdbc96a541365d60fffd00047893b9d1d4d7456a044b18aae34483b1cbdfec79'
            'c0650511a8d371d4a398bebd7a7e164718fa0b55961e8bdc6d2080236fa1a9b5'
            '75bbd2ae5f6dbeda0119de20844d704b72d7f0e594ff71c50bdab059418b7218'
            'caccce6112e00f10f4e9896a00ac565cc2352434090da0a2980f2da111d6eaf3'
            '8a957c2a0b74bed0a529103e949f9dcd98a98424ca40fdffce17153ab7e9840c'
            '49b73754217cbfd54478fa85f226e1ce8be1ac661c0feb022127f2bc5f63ff04'
            '2fc610133217a52f399a6ba3a8414365e27afcb335f1b57c45d3a0fc6327b532'
            '244454fc772042af3fbb9bee209a748b573964aabce1e996cd95dd792aa3fcb6'
            '2c967095d144f700317ad3af50161cc54ffc215d883d629eabf92b00cb796b51'
            'f5187667193eb476589685defa1ed3755413e2aa1a6db6f419b58a84e8a07a2b'
            '69933cc943f0e5b257da0b62d4b2eb5116e0e210af4ac8d9dc0a246879c6206f'
            '91b584c062e11d44620803bd06ad67e5cf33b214f28a8998b6a51ab0e08cc0b6'
            '6adbe371b1e3f284bd317bf3a2656ba8a665f0afe1704aabca15db9088e7cda0'
            '5f9ce0dc4e7174c548708bef267e6eda7710a7b6dde64a1224f58c107d0a1e10'
            'b06524a2507b5bec24c3b11fec422c2a844cbf872bbf942d3ce1c979f03ee6a7'
            '3c17dcb38a122e9746fd21cd285704ea41ab9476717231f6b1b181efd7883cf0'
            '87b83a6ffcca3f1be046fdd813047b65186d5005b6b6ee4bc0ae3721d2d09877'
            '5c6ab052b7d781aa2fd13936b5a2e7e948085e78766126437e1d0a1d435d3163'
            'b7eda81831de440b4afd53c6bb491c5c0b6c59565c8c14c059b9e0d6482aac02')

package() {
    # Hide apps we don't care
    mkdir -p "$pkgdir"/usr/share/manjaro/applications
    cp "$srcdir"/*.desktop "$pkgdir"/usr/share/manjaro/applications/

    # Install gtk3 settings
    install -Dm644 "${srcdir}/gtk3-settings.ini" "${pkgdir}/etc/gtk-3.0/settings.ini"

    install -Dm755 "${srcdir}/manjaro-tweaks.sh" -t "${pkgdir}/etc/profile.d"
    install -Dm644 "${srcdir}/90_manjaro.gschema.override" -t "${pkgdir}/usr/share/glib-2.0/schemas"
    install -Dm644 "${srcdir}/manjaro.cfg" -t "${pkgdir}/usr/lib/firefox/"
    install -Dm644 "${srcdir}/autoconfig.js" -t "${pkgdir}/usr/lib/firefox/defaults/pref"
    install -Dm644 "${srcdir}/90-usb-gadget-managed.rules" -t "${pkgdir}/usr/lib/udev/rules.d"
    install -Dm644 "${srcdir}/99-automount-sd.rules" -t "${pkgdir}/usr/lib/udev/rules.d"
    install -Dm644 "${srcdir}/manjaro.json" -t "${pkgdir}/usr/share/feedbackd/themes"
    install -Dm644 "${srcdir}/org.freedesktop.ModemManager1.pkla" -t "${pkgdir}/var/lib/polkit-1/localauthority/10-vendor.d"
    install -Dm644 "${srcdir}/ignore-power-key.conf" -t "${pkgdir}/etc/systemd/logind.conf.d"
    install -Dm755 "${srcdir}/dconf-profile-manjaro" "${pkgdir}/etc/dconf/profile/user"
    install -Dm755 "${srcdir}/01-phoc-scaling" -t "${pkgdir}/etc/dconf/db/manjaro.d"
    install -Dm644 "${srcdir}/10-proximity.rules" -t "${pkgdir}/usr/lib/udev/rules.d"
    install -Dm755 "${srcdir}/pinephone-suspend-hook.sh" -t "${pkgdir}/usr/lib/systemd/system-sleep/"
    install -Dm644 "${srcdir}/20-pinephone-led.rules" -t "${pkgdir}/usr/lib/udev/rules.d"
    install -Dm644 "${srcdir}/phosh-renice.service" -t "${pkgdir}/usr/lib/systemd/system/"
    install -Dm755 "${srcdir}/phosh_renice.sh" "${pkgdir}/usr/bin/phosh_renice"
}
