From 0010550ad6f7d053b83f1857215294ce2b69f833 Mon Sep 17 00:00:00 2001
From: Michael Gratton <mike@vee.net>
Date: Mon, 12 Oct 2020 23:22:47 +1100
Subject: [PATCH 067/124] Application.Client: Work around libhandy bug when
 opening main windows

GNOME/libhandy#305
---
 src/client/application/application-client.vala | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/src/client/application/application-client.vala b/src/client/application/application-client.vala
index 2bf4e094..46469086 100644
--- a/src/client/application/application-client.vala
+++ b/src/client/application/application-client.vala
@@ -892,6 +892,15 @@ public class Application.Client : Gtk.Application {
     }
 
     private MainWindow new_main_window(bool select_first_inbox) {
+        // Work around warning caused by GNOME/libhandy#305 which
+        // makes it a pita to run with G_DEBUG=fatal-warnings. Remove
+        // once the fix for that issue has been released and packaged.
+        GLib.Test.expect_message(
+            "GLib-GObject",
+            LEVEL_WARNING,
+            "g_object_weak_unref: couldn't find weak ref *"
+        );
+
         MainWindow window = new MainWindow(this);
         this.controller.register_window(window);
         window.focus_in_event.connect(on_main_window_focus_in);
-- 
2.29.2

